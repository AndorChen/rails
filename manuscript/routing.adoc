[[rails-routing-from-the-outside-in]]
== Rails 路由全解
:imagesdir: ../images
:numbered:

[.chapter-abstract]
--
本文介绍 Rails 路由面向用户的特性。

读完本文后，你将学会：

* 如何理解 `config/routes.rb` 文件中的代码。
* 如何使用推荐的资源式风格或 `match` 方法构建路由。
* 动作应该收到什么参数。
* 如何使用路由帮助方法自动创建路径和 URL 地址。
* 约束和 Rack 端点等高级技术。
--

[[the-purpose-of-the-rails-router]]
=== Rails 路由的用途

Rails 路由能识别 URL 地址，并把它们分发给控制器动作进行处理。它还能生成路径和 URL 地址，从而避免在视图中硬编码字符串。

[[connecting-urls-to-code]]
==== 把 URL 地址连接到代码

当 Rails 程序收到下面的访问请求时：

[source,ruby]
----
GET /patients/17
----

会查询路由并找到匹配的控制器动作。如果第一个匹配的路由是：

[source,ruby]
----
get '/patients/:id', to: 'patients#show'
----

该请求会被分发给 `patients` 控制器的 `show` 动作，同时会传入包含 `{ id: '17' }` 的 `params`。

[[generating-paths-and-urls-from-code]]
==== 从代码生成路径和 URL 地址

我们还可以生成路径和 URL 地址。如果把上面的路由修改为：

[source,ruby]
----
get '/patients/:id', to: 'patients#show', as: 'patient'
----

并且在控制器中包含下面的代码：

[source,ruby]
----
@patient = Patient.find(17)
----

同时在对应的视图中包含下面的代码：

[source,erb]
----
<%= link_to 'Patient Record', patient_path(@patient) %>
----

那么路由会生成路径 `/patients/17`。这种做法使视图代码更容易维护和理解。注意，在路由帮助方法中不需要指定 ID。

[[resource-routing-the-rails-default]]
=== 资源路由：Rails 的默认风格
